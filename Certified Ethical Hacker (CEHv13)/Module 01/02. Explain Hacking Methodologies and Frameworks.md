## CEH Hacking Methodology (CHM)

![[Pasted image 20241106165535.png]]

The **CEH Hacking Methodology (CHM)**, focusing on the stages of ethical hacking. Here's an elaboration with real-world examples:

---

### 1. **Footprinting**

**Definition**: Gathering as much information about the target as possible.

- **Examples**:
    - **DNS Footprinting**: Using tools like _nslookup_ or _dig_ to gather DNS records.
    - **Social Media Profiling**: Collecting information about a company or individual from LinkedIn, Twitter, etc.
    - **Google Dorking**: Using advanced search operators to find sensitive information like login pages or exposed documents.
    - **Whois Lookup**: Identifying domain ownership and registration details.

---

### 2. **Scanning**

**Definition**: Actively probing the target to discover open ports, services, and vulnerabilities.

- **Examples**:
    - **Port Scanning**: Using tools like _Nmap_ to find open ports (e.g., Port 80 for HTTP or 3389 for RDP).
    - **Network Mapping**: Creating a topology of the network using tools like _Zenmap_ or _Netdiscover_.
    - **Vulnerability Scanning**: Scanning for vulnerabilities using _Nessus_ or _OpenVAS_.

---

### 3. **Enumeration**

**Definition**: Extracting detailed information from the target, such as user accounts or shared resources.

- **Examples**:
    - **SMB Enumeration**: Using tools like _Enum4linux_ or _Metasploit_ to list shared folders on a Windows server.
    - **SNMP Enumeration**: Extracting network configuration using SNMP tools like _snmpwalk_.
    - **Active Directory Enumeration**: Enumerating users and groups in an AD environment using tools like _BloodHound_.

---

### 4. **Vulnerability Analysis**

**Definition**: Identifying weaknesses in the system that can be exploited.

- **Examples**:
    - **CVE Search**: Looking up known vulnerabilities in the National Vulnerability Database.
    - **Exploiting Misconfigurations**: Identifying weak passwords or default credentials.
    - **Using Exploit Databases**: Finding exploits in platforms like _Exploit-DB_ for discovered vulnerabilities.

---

### 5. **System Hacking**

- **Gaining Access**
    
    - **Cracking Passwords**: Brute-forcing or dictionary attacks using tools like _John the Ripper_ or _Hydra_.
    - **Exploitation**: Using an exploit from _Metasploit_ to gain access (e.g., exploiting EternalBlue for SMB).
- **Escalating Privileges**
    
    - **Examples**:
        - Exploiting _Sudo Misconfigurations_ on Linux to gain root.
        - Using _Mimikatz_ to extract plaintext passwords from memory in Windows.
- **Maintaining Access**
    
    - **Examples**:
        - Installing a backdoor like a web shell (e.g., _China Chopper_).
        - Creating a new admin account for persistence.
- **Clearing Logs**
    
    - **Examples**:
        - Using `wevtutil` on Windows to clear event logs.
        - Modifying or deleting logs in Linux using `shred` or editing log files.

---

This methodology highlights the step-by-step process ethical hackers use to assess and improve security.

## Cyber Kill Chain Methodology
![[Pasted image 20241121214409.png]]

The **Cyber Kill Chain Methodology**—a step-by-step framework used to understand and prevent cyber intrusion activities. 
The Cyber Kill Chain framework, developed by **Lockheed Martin** (2022), explains how attackers move through networks to identify vulnerabilities that they can then exploit. Attackers use the steps in the Cyber Kill Chain when conducting offensive operations in cyberspace against their targets. If you’re responsible for defending a network, this model can help you understand the stages of a cyberattack and the measures you can take to prevent or intercept each step.

---

### 1. **Reconnaissance**

**Definition**: Gathering information about the target to identify potential vulnerabilities.

- **Techniques**:
    - **Passive Reconnaissance**: Using tools like _Shodan_, _Google Dorking_, or social media to collect publicly available information.
    - **Active Reconnaissance**: Scanning the network with tools like _Nmap_ to find open ports or services.
- **Examples**:
    - Identifying a company’s domain and subdomains using _Sublist3r_.
    - Collecting employee details via LinkedIn to craft phishing emails.

---

### 2. **Weaponization**

**Definition**: Creating a malicious payload, such as a backdoor or malware, designed to exploit a target's vulnerability.

- **Techniques**:
    - Using frameworks like _Metasploit_ to craft malicious exploits.
    - Embedding malware in seemingly legitimate documents or applications using tools like _MSFVenom_.
- **Examples**:
    - Crafting a malicious PDF that exploits an Adobe Reader vulnerability (e.g., CVE-2019-14586).
    - Creating a trojanized Excel file with embedded macros to execute a reverse shell.

---

### 3. **Delivery**

**Definition**: Transmitting the weaponized payload to the target.

- **Techniques**:
    - **Phishing**: Sending emails with malicious attachments or links.
    - **USB Drops**: Planting infected USB drives in public spaces.
    - **Drive-by Downloads**: Hosting malicious code on compromised websites.
- **Examples**:
    - Sending a spear-phishing email containing a link to a malicious Word document.
    - Hosting malware on a fake login page that mimics a legitimate service.

---

### 4. **Exploitation**

**Definition**: Triggering the vulnerability to execute the malicious payload on the target system.

- **Techniques**:
    - Exploiting outdated software (e.g., Apache Struts vulnerability CVE-2017-5638).
    - Leveraging privilege escalation techniques to gain deeper access.
- **Examples**:
    - Exploiting an unpatched Windows SMB service using the EternalBlue vulnerability (CVE-2017-0144).
    - Executing a cross-site scripting (XSS) attack to inject malicious JavaScript into a web application.

---

### 5. **Installation**

**Definition**: Installing malicious software or scripts on the target system to establish persistence.

- **Techniques**:
    - Deploying backdoors or trojans like _RATs_ (Remote Access Trojans).
    - Installing keyloggers or rootkits to monitor activities or maintain stealth.
- **Examples**:
    - Installing a _Meterpreter_ session through Metasploit for remote access.
    - Deploying a persistent web shell like _China Chopper_ on a compromised server.

---

### 6. **Command and Control (C2)**

**Definition**: Establishing a communication channel to remotely control the compromised system.

- **Techniques**:
    - Using C2 frameworks like _Cobalt Strike_ or _Empire_.
    - Communicating via DNS tunneling, HTTP, or HTTPS to bypass network firewalls.
- **Examples**:
    - Setting up a C2 server to manage multiple compromised hosts using encrypted traffic.
    - Using tools like _ngrok_ to tunnel C2 traffic and evade detection.

---

### 7. **Actions on Objectives**

**Definition**: Performing final actions to achieve the attacker's goal, such as exfiltrating data, sabotaging systems, or disrupting services.

- **Techniques**:
    - **Data Exfiltration**: Using tools like _Rclone_ or _WinSCP_ to transfer sensitive data.
    - **Ransomware Deployment**: Encrypting files and demanding payment for decryption keys.
    - **System Sabotage**: Deleting critical files or deploying destructive malware like _Wiper_.
- **Examples**:
    - Stealing customer data from a database for resale on the dark web.
    - Encrypting a company’s data and demanding cryptocurrency as ransom.

---

### Preventive Strategies

Each stage of the Cyber Kill Chain provides opportunities for defense:

- **Reconnaissance**: Employ web application firewalls (WAFs) and monitor external network activity.
- **Weaponization**: Use email filters and sandboxing to detect malicious attachments.
- **Delivery**: Train employees to recognize phishing attacks.
- **Exploitation**: Patch vulnerabilities promptly and deploy endpoint protection systems.
- **Installation**: Use intrusion detection systems (IDS) to block malicious installations.
- **Command and Control**: Monitor outbound traffic and block known C2 IP addresses/domains.
- **Actions on Objectives**: Encrypt sensitive data and perform regular backups.

---

The Cyber Kill Chain helps security professionals analyse, prevent, and respond to attacks effectively.

## Tactics, Techniques, and Procedures (TTPs)

**Tactics, Techniques, and Procedures (TTPs)** are critical components in understanding and analyzing the behavior of adversaries in cybersecurity. This framework is part of threat intelligence and helps security professionals understand how attackers operate. 

Here’s an elaboration of TTPs:

---

### **1. Tactics**

- **Definition**: Tactics refer to the high-level objectives or goals of the adversary during an attack. These goals often align with the stages of the Cyber Kill Chain or MITRE ATT&CK Framework.
    
- **Common Tactics in CEH Context**:
    
    1. **Initial Access**: Methods to gain entry into the target environment.
        - Example: Spear-phishing emails, exploiting vulnerabilities, or brute-forcing login credentials.
    2. **Persistence**: Techniques to maintain access over time, even after reboots or detection.
        - Example: Installing backdoors or using scheduled tasks.
    3. **Privilege Escalation**: Moving from low-privileged access to higher privileges.
        - Example: Exploiting misconfigured SUID binaries in Linux.
    4. **Defence Evasion**: Techniques to bypass security mechanisms.
        - Example: Encrypting payloads to bypass antivirus detection.
    5. **Credential Access**: Harvesting passwords or authentication tokens.
        - Example: Using tools like _Mimikatz_ to extract credentials from Windows memory.
    6. **Exfiltration**: Transferring stolen data to the attacker’s system.
        - Example: Using _Rclone_ to upload data to cloud storage.

---

### **2. Techniques**

- **Definition**: Techniques are the specific methods or processes attackers use to achieve their tactics. Each tactic can have multiple techniques.
    
- **Examples of Techniques in CEH Context**:
    
    1. **Phishing (Initial Access)**:
        - Crafting emails with malicious links or attachments that trick users into opening them.
        - Example: Using _SET (Social-Engineer Toolkit)_ to send convincing phishing emails.
    2. **Exploiting Software Vulnerabilities (Initial Access)**:
        - Exploiting known vulnerabilities like _CVE-2017-0144_ (EternalBlue) to compromise systems.
    3. **DLL Injection (Defense Evasion)**:
        - Injecting malicious code into legitimate processes to evade detection.
        - Example: Using Metasploit’s _DLL injection module_.
    4. **Credential Dumping (Credential Access)**:
        - Extracting passwords from SAM (Security Account Manager) files on Windows systems.
        - Example: Tools like _Mimikatz_ or _LaZagne_.
    5. **Command and Control via DNS Tunneling (Command and Control)**:
        - Sending encoded messages over DNS queries to communicate with a remote server.
        - Example: Using tools like _Iodine_.

---

### **3. Procedures**

- **Definition**: Procedures are the detailed steps or workflows attackers follow to implement techniques. Procedures vary between adversaries depending on their expertise, resources, and objectives.
    
- **Examples of Procedures in CEH Context**:
    
    1. **Phishing Workflow**:
        - **Step 1**: Create a phishing email with a malicious attachment (e.g., a Word file with macros).
        - **Step 2**: Use tools like _Gophish_ to send bulk phishing emails.
        - **Step 3**: Harvest credentials or install malware when the user opens the attachment.
    2. **Privilege Escalation Workflow**:
        - **Step 1**: Identify misconfigured permissions or vulnerable applications (e.g., unpatched sudo).
        - **Step 2**: Exploit the identified vulnerability to gain administrative access.
    3. **Data Exfiltration Workflow**:
        - **Step 1**: Compress sensitive files using tools like _7zip_ or _WinRAR_.
        - **Step 2**: Encrypt files to evade detection.
        - **Step 3**: Use _FTP_, _Rclone_, or HTTP POST requests to transfer data to a remote server.

---

### **TTPs in Practice: Attack Scenario**

#### **Example 1: Credential Dumping via Mimikatz**

- **Tactic**: Credential Access.
- **Technique**: Credential Dumping.
- **Procedure**:
    1. Use Mimikatz to dump plaintext passwords from LSASS memory.
    2. Authenticate with dumped credentials on other machines in the network.
    3. Maintain persistence by creating an administrative account with the stolen credentials.

#### **Example 2: Exploiting SMB Vulnerability**

- **Tactic**: Initial Access.
- **Technique**: Exploiting Unpatched Services.
- **Procedure**:
    1. Scan the network using _Nmap_ to identify SMB service running on Port 445.
    2. Confirm the presence of the EternalBlue vulnerability (CVE-2017-0144).
    3. Use Metasploit to launch the exploit and gain remote shell access.
    4. Deploy a backdoor for persistence.

---

### **Why TTPs Matter in CEH?**

Understanding TTPs helps ethical hackers:

- **Detect Threats**: By correlating TTPs to specific adversary behaviors (e.g., ransomware campaigns).
- **Mitigate Risks**: Identifying patterns in TTPs to predict and prevent future attacks.
- **Improve Incident Response**: Building defenses around known adversarial tactics and techniques.

### **Defensive Measures Against TTPs**

1. **Reconnaissance Prevention**:
    
    - Use anti-reconnaissance tools like _Snort_ to detect scanning activities.
    - Restrict information leakage via DNS, WHOIS, or social media.
2. **Exploitation Prevention**:
    
    - Regularly patch systems and applications.
    - Implement IDS/IPS solutions like _Suricata_ or _Zeek_.
3. **Credential Protection**:
    
    - Enforce multi-factor authentication (MFA).
    - Use tools like _LAPS_ (Local Administrator Password Solution) to manage local admin credentials securely.
4. **Command and Control Prevention**:
    
    - Monitor outbound traffic for anomalies.
    - Block known C2 domains using threat intelligence feeds.

---

This structured understanding of **TTPs** equips ethical hackers with tools and techniques to effectively counteract cyber threats. Let me know if you’d like more real-world scenarios or tool recommendations!